!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):t.KDBush=o()}(this,function(){"use strict";function t(e,n,r,i,s,h,a){if(!(s-i<=r)){var u=i+s>>1;!function t(e,n,r,i,s,h,a){for(;s>i;){if(s-i>600){var u=s-i+1,p=r-i+1,f=Math.log(u),c=.5*Math.exp(2*f/3),v=.5*Math.sqrt(f*c*(u-c)/u)*(p-u/2<0?-1:1),d=Math.max(i,Math.floor(r-p*c/u+v)),l=Math.min(s,Math.floor(r+(u-p)*c/u+v));t(e,n,r,d,l,h,a)}var g=n[a*r+h],y=i,x=s;for(o(e,n,i,r,a),n[a*s+h]>g&&o(e,n,i,s,a);y<x;){for(o(e,n,y,x,a),y++,x--;n[a*y+h]<g;)y++;for(;n[a*x+h]>g;)x--}n[a*i+h]===g?o(e,n,i,x,a):o(e,n,++x,s,a),x<=r&&(i=x+1),r<=x&&(s=x-1)}}(e,n,u,i,s,h,a),t(e,n,r,i,u-1,(1+h)%a,a),t(e,n,r,u+1,s,(1+h)%a,a)}}function o(t,o,n,r,i){e(t,n,r),e(o,i*n+0,i*r+0),e(o,i*n+1,i*r+1),e(o,i*n+2,i*r+2)}function e(t,o,e){var n=t[o];t[o]=t[e],t[e]=n}function n(t,o,e,n,r,i){var s=t-n,h=o-r,a=e-i;return s*s+h*h+a*a}var r=function(o){var e=o.points,n=o.getX,r=o.getY,i=o.getZ,s=o.nodeSize,h=o.ArrayType,a=o.axisCount;this.nodeSize=s,this.points=e,this.axisCount=a;for(var u=e.length<65536?Uint16Array:Uint32Array,p=this.ids=new u(e.length),f=this.coords=new h(e.length*a),c=0;c<e.length;c++)p[c]=c,f[a*c+0]=n(e[c]),f[a*c+1]=r(e[c]),f[a*c+2]=i(e[c]);t(p,f,s,0,p.length-1,0,a)};return r.prototype.range=function(t,o,e,n,r,i){return function(t,o,e,n,r,i,s,h,a,u){for(var p=[0,t.length-1,0],f=[];p.length;){var c=p.pop(),v=p.pop(),d=p.pop();if(v-d<=a)for(var l=d;l<=v;l++){var g=o[u*l+0],y=o[u*l+1],x=o[u*l+2];g>=e&&g<=i&&y>=n&&y<=s&&x>=r&&x<=h&&f.push(t[l])}else{var M=d+v>>1,b=o[u*M+0],m=o[u*M+1],w=o[u*M+2];b>=e&&b<=i&&m>=n&&m<=s&&w>=r&&w<=h&&f.push(t[M]);var k=(1+c)%u,z=void 0,C=void 0;switch(c){case 0:z=e<=b,C=i>=b;break;case 1:z=n<=m,C=s>=m;break;case 2:z=r<=w,C=h>=w}z&&(p.push(d),p.push(M-1),p.push(k)),C&&(p.push(M+1),p.push(v),p.push(k))}}return f}(this.ids,this.coords,t,o,e,n,r,i,this.nodeSize,this.axisCount)},r.prototype.within=function(t,o,e,r){return function(t,o,e,r,i,s,h,a){for(var u=[0,t.length-1,0],p=[],f=s*s;u.length;){var c=u.pop(),v=u.pop(),d=u.pop();if(v-d<=h)for(var l=d;l<=v;l++)n(o[a*l+0],o[a*l+1],o[a*l+2],e,r,i)<=f&&p.push(t[l]);else{var g=d+v>>1,y=o[a*g+0],x=o[a*g+1],M=o[a*g+2];n(y,x,M,e,r,i)<=f&&p.push(t[g]);var b=(1+c)%a,m=void 0,w=void 0;switch(c){case 0:m=e-s<=y,w=e+s>=y;break;case 1:m=r-s<=x,w=r+s>=x;break;case 2:m=i-s<=M,w=i+s>=M}m&&(u.push(d),u.push(g-1),u.push(b)),w&&(u.push(g+1),u.push(v),u.push(b))}}return p}(this.ids,this.coords,t,o,e,r,this.nodeSize,this.axisCount)},r});
